# Домашнее задание к занятию «Микросервисы: масштабирование»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: Кластеризация

Предложите решение для обеспечения развёртывания, запуска и управления приложениями.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- поддержка контейнеров;
- обеспечивать обнаружение сервисов и маршрутизацию запросов;
- обеспечивать возможность горизонтального масштабирования;
- обеспечивать возможность автоматического масштабирования;
- обеспечивать явное разделение ресурсов, доступных извне и внутри системы;
- обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т. п.

Обоснуйте свой выбор.

## Решение 1

Для решения требований по развертыванию, запуску и управлению приложениями, я предлагаю использовать сочетание Kubernetes, Helm, и HashiCorp Vault. Это решение обеспечивает гибкость, автоматизацию и безопасность, требуемые для работы современных распределенных систем на основе контейнеров.

1. Kubernetes (K8s) – оркестрация контейнеров
Kubernetes предоставляет все необходимые механизмы для управления контейнерами, таких как:

- Поддержка контейнеров: Kubernetes управляет контейнерами через поды, которые могут состоять из одного или нескольких контейнеров.

- Обнаружение сервисов и маршрутизация: В Kubernetes встроена служба DNS, которая позволяет автоматически обнаруживать сервисы. Для маршрутизации запросов используется объект Ingress, позволяющий управлять доступом к сервисам извне.

- Горизонтальное масштабирование: Kubernetes поддерживает горизонтальное масштабирование через механизм Horizontal Pod Autoscaler, который масштабирует количество подов на основе метрик, таких как использование CPU или пользовательские метрики.

- Автоматическое масштабирование: Kubernetes позволяет автоматически изменять количество подов в зависимости от нагрузки с помощью HPA (Horizontal Pod Autoscaler) и Cluster Autoscaler для динамического изменения числа узлов в кластере.

- Разделение ресурсов: Kubernetes поддерживает сеть namespaces, которая позволяет изолировать ресурсы и разделить доступы между внешними и внутренними компонентами.

- Конфигурирование с использованием переменных среды: Конфигурация приложений через переменные окружения поддерживается в Kubernetes с помощью объектов ConfigMap и Secret. Это позволяет безопасно хранить и управлять конфиденциальными данными.

2. Helm – управление манифестами и шаблонизацией

Helm является менеджером пакетов для Kubernetes, который:

- Обеспечивает возможность удобного и повторяемого развертывания приложений.

- Позволяет параметризовать конфигурацию приложений через использование Helm-чартов, где можно легко задавать переменные, включая чувствительные данные.

- Упрощает обновление, управление версиями и откаты приложений, развернутых в кластере.

3. HashiCorp Vault – безопасное хранение конфиденциальных данных

Vault обеспечивает безопасное хранение и управление чувствительными данными, такими как пароли, ключи доступа и ключи шифрования:

- Интеграция с Kubernetes: Vault может быть интегрирован с Kubernetes через механизм K8s Secrets и обеспечивать динамическое управление ключами доступа, шифрованием данных и конфиденциальными переменными среды.

- Управление доступом: Vault может настраивать политики доступа для приложений, предоставляя им временные и безопасные учетные данные.

Пример взаимодействия компонентов:
1. Развертывание:

- Вы создаете чарт Helm для своего приложения, где описываете контейнеры, сетевые настройки, ресурсы и конфигурацию переменных окружения.

- Чарт Helm разворачивается в Kubernetes-кластере, используя kubectl и параметры, переданные через Helm.

2. Обнаружение и маршрутизация:

- Kubernetes автоматически создает DNS-имена для сервисов. Внешний доступ обеспечивается через Ingress или LoadBalancer.
Масштабирование:

Kubernetes автоматически масштабирует ваши приложения с помощью HPA на основе метрик, собранных системой мониторинга (например, Prometheus).

3. Безопасное хранение секретов:

- Vault хранит конфиденциальные данные и через встроенные механизмы интеграции передает их в Kubernetes как секреты, доступные приложениям через переменные окружения или файлы.

**Обоснование выбора:**

- Kubernetes является стандартом для оркестрации контейнеров и обладает всеми необходимыми возможностями для обеспечения обнаружения сервисов, автоматического масштабирования и управления сетевыми ресурсами.

- Helm упрощает управление развертыванием и обновлением приложений в Kubernetes, предоставляя гибкость через шаблонизацию.

- Vault обеспечивает безопасность чувствительных данных, их управление и интеграцию с Kubernetes, что позволяет эффективно работать с конфиденциальной информацией, необходимой для настройки приложений.

Альтернативным вариантом Kubernetes может являться OpenShift, который в свою очередь основан на Kubernetes, а значит к нему также подходят все требования к системе на основе микросервисной архитектуры. Но OpenShift имеет ограничения в бесплатной версии, что может привести к необходимости покупки корпоративной версии. Также OpenShift меньше аудитория и может быть меньше справочных материалов
